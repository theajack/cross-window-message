!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.initMessager=n():e.initMessager=n()}(this,(function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";function r(){var e=[],n=null,t=!0;function r(n){var t=e.find((function(e){return e.listener===n}));t&&e.splice(e.indexOf(t),1)}return{onEventReady:function(t){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var a,u=!1,s=!1,c=!1;return"object"==typeof t?("boolean"==typeof t.once&&(u=t.once),"boolean"==typeof t.after&&(s=t.after),"boolean"==typeof t.head&&(c=t.head),a=t.listener):a=t,e.find((function(e){return e.listener===a}))||e[c?"unshift":"push"]({listener:a,args:i,once:u}),null===n||s||(0===i.length&&n&&(i=n),a.apply(void 0,i),u&&r(a)),a},eventReady:function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];n=i,e.forEach((function(e){e.listener.apply(e,0===i.length?e.args:i),e.once&&r(e.listener)})),t=!1},removeListener:r,isFirstReady:function(){return t}}}t.r(n),t.d(n,"default",(function(){return z}));var i=window.localStorage;function o(e){return e+"_note"}function a(e,n){var t=typeof n;"object"===t?n=JSON.stringify(n):"string"!==t&&(n=n.toString()),i.setItem(o(e),t+":"+n)}function u(e){var n=i.getItem(o(e));return null===n?null:s(n)}function s(e){if(null===e)return null;var n=e.indexOf(":"),t="string";if(-1!==n){var r=e.substr(0,n);-1!==["string","number","boolean","object","undefined"].indexOf(r)&&(t=r,e=e.substr(n+1))}if("number"===t)return parseFloat(e);if("boolean"===t)return"true"===e;if("object"===t)try{return JSON.parse(e)}catch(e){return null}return e}function c(){var e={};return Object.keys(i).forEach((function(n){e[n]=i.getItem(n)})),e}function f(e){i.removeItem(o(e))}function d(){Object.keys(i).forEach((function(e){i.removeItem(e)}))}var g=function(e,n){if("object"!=typeof e||null===e)if(void 0===n){if(void 0===e)return c();if(null!==e)return u(e);d()}else{if(null!==n)return a(e,n);f(e)}else for(var t in e)g(t,e[t])};g.useLocalStorage=function(){i=window.localStorage},g.useSessionStorage=function(){i=window.sessionStorage},g.read=u,g.readAll=c,g.write=a,g.remove=f,g.clear=d,g.parseValue=s,g.parseKey=function(e){var n=e.length-"_note".length;return"_note"===e.substr(n)?e.substr(0,n):e},g.geneKey=o;var l=g,p=1,v=2,y=3,m=4,b=5,h=6,w=7,S=8;function P(){window.close(),setTimeout((function(){window.location.href="https://tackchen.gitee.io/404.html?h="+encodeURIComponent(location.host)}),100)}var T,k,M,O=(T="",k="visibilityState",M="",void 0!==document.hidden?(T="hidden",M="visibilitychange",k="visibilityState"):void 0!==document.mozHidden?(T="mozHidden",M="mozvisibilitychange",k="mozVisibilityState"):void 0!==document.msHidden?(T="msHidden",M="msvisibilitychange",k="msVisibilityState"):void 0!==document.webkitHidden&&(T="webkitHidden",M="webkitvisibilitychange",k="webkitVisibilityState"),{hidden:T,state:k,visibilityChange:M});function x(){return document[O.state]===O.hidden}function I(){var e=l.read("cwm_page_queue");return e instanceof Array?e:[]}function j(e){var n=I(),t=n.find((function(n){return n.id===e}));return{pageQueue:n,page:t}}function _(e){l.write("cwm_page_queue",e)}function N(e){!function(e,n){void 0===n&&(n=!0);var t=j(e),r=t.pageQueue,i=t.page;if(i)return r.splice(r.indexOf(i),1),n&&_(r),!0}(e.id)}function H(){var e=I();return 0===e.length?null:e[e.length-1]}function C(){var e=I();return 0===e.length?null:(e.sort((function(e,n){return n.index-e.index})),e[0])}function E(e,n){void 0===n&&(n=!1);var t=j(e),r=t.pageQueue,i=t.page;i&&(n&&(i.show=!0),r.splice(r.indexOf(i),1),r.push(i),_(r))}var L,R,U=function(){return(U=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function V(e,n){return function(t){var r="string"==typeof t.targetPageId,i="string"==typeof t.targetPageName;(!r&&!i||r&&t.targetPageId===e.id||i&&t.targetPageName===e.name)&&(t.innerMessageType?function(e,n){var t=e.innerMessageType,r=e.page,i=e.data,o=function(e){return n.id===e},a=function(e){return n.name===e};switch(t){case v:o(r.id)||P();break;case p:!o(r.id)&&a(r.name)&&P();break;case h:o(i.pageId)&&alert(i.text);break;case b:a(i.pageName)&&alert(i.text);break;case y:o(i)&&P();break;case m:a(i)&&P();break;case w:o(i)||R({targetPageId:r.id,innerMessageType:S});break;case S:Q.onReply(r.id)}}(t,e):n(t))}}function z(e){var n=void 0===e?{}:e,t=n.pageName,i=void 0===t?location.pathname.replace(/\//g,"_"):t,o=n.pageId,a=void 0===o?"":o,u=n.useSessionStorage,s=n.data;if(L)return L;!0===u&&l.useSessionStorage();var c,f=function(){var e;!function(e){e[e.Unload=0]="Unload",e[e.Click=1]="Click",e[e.Show=2]="Show",e[e.Hide=3]="Hide"}(e||(e={}));var n=r(),t=n.onEventReady,i=n.eventReady,o=n.removeListener,a=function(e,n){var r=function(t){var r=t.type,i=t.event;n===r&&e(i)};return t({after:!0,listener:r}),function(){return o(r)}},u=function(e,n){return i({type:n,event:e})};return{events:{onUnload:function(n){return a(n,e.Unload)},onClick:function(n){return a(n,e.Click)},onShow:function(n){return a(n,e.Show)},onHide:function(n){return a(n,e.Hide)}},triggerUnload:function(n){return u(n,e.Unload)},triggerClick:function(n){return u(n,e.Click)},triggerPageShow:function(n){return u(n,e.Show)},triggerPageHide:function(n){return u(n,e.Hide)}}}(),d=function(e,n,t){var r,i,o=I(),a={name:e,id:n||""+e+Date.now().toString().substr(4)+(r=1e5,i=999999,r+Math.round(Math.random()*(i-r))),index:o.length,show:!x()};return void 0!==t&&(a.data=t),o.push(a),_(o),a}(i,a,s);c=function(e){N(d),f.triggerUnload(e)},window.addEventListener("beforeunload",c,!0);var g=r(),w=g.onEventReady,S=g.eventReady,P=g.removeListener,T=V(d,S);!function(e){window.addEventListener("storage",(function(n){if(n.key&&"cross_window_msg"!==l.parseKey(n.key))return null;var t=null!==n.newValue?l.parseValue(n.newValue):null;t&&e(t)}),!1)}(T),function(e,n){var t=0;R=function(r){var i=r.data,o=void 0===i?null:i,a=r.messageType,u=void 0===a?"":a,s=r.innerMessageType,c=r.targetPageId,f=r.targetPageName,d={data:o,page:e,messageType:u,messageId:e.id+"-"+t++};"number"==typeof s&&(d.innerMessageType=s),"string"==typeof c&&(d.targetPageId=c),"string"==typeof f&&(d.targetPageName=f),l.write("cross_window_msg",d),n(d)}}(d,T);var k=U(U({pageId:d.id,pageName:i,postMessage:function(e,n){void 0===n&&(n=""),R({data:e,messageType:n})},postMessageToTargetId:function(e,n,t){R({targetPageId:e,data:n,messageType:t})},postMessageToTargetName:function(e,n,t){R({targetPageName:e,data:n,messageType:t})},onMessage:function(e){return w(e),function(){return P(e)}}},f.events),{method:{closeOtherPage:function(){R({innerMessageType:v})},closeOtherSamePage:function(){R({innerMessageType:p})},alertInTargetName:function(e,n){R({data:{text:e,pageName:n},innerMessageType:b})},alertInTargetId:function(e,n){R({data:{text:e,pageId:n},innerMessageType:h})},closePageByPageName:function(e){R({data:e,innerMessageType:m})},closePageByPageId:function(e){R({data:e,innerMessageType:y})},getLastOpenPage:C,getLatestActivePage:H,getAllPages:function(){return I()}}});return L=k,Q.send(),function(e,n){t=function(t){E(e,!0),n.triggerPageShow(t)},r=function(t){!function(e){var n=j(e),t=n.pageQueue,r=n.page;r&&(r.show=!1,_(t))}(e),n.triggerPageHide(t)},i=function(e){x()?r&&r(e):t(e)},document.removeEventListener(O.visibilityChange,i,!1),document.addEventListener(O.visibilityChange,i,!1),window.addEventListener("click",(function(t){E(e),n.triggerClick(t)}),!0);var t,r,i}(d.id,f),k}z.version="1.0.2";var A,Q=(A=[],{onReply:function(e){-1===A.indexOf(e)&&A.push(e)},send:function(){R({innerMessageType:w}),setTimeout((function(){!function(e){for(var n=I(),t=!1,r=n.length-1;r>=0;r--)-1===e.indexOf(n[r].id)&&(n.splice(r,1),t=!0);t&&_(n)}(A)}),300)}})}]).default}));