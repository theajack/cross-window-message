!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.initMessager=n():e.initMessager=n()}(this,(function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";function r(){var e=[],n=null,t=!0;function r(n){var t=e.find((function(e){return e.listener===n}));t&&e.splice(e.indexOf(t),1)}return{onEventReady:function(t){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var a,u=!1,s=!1,c=!1;return"object"==typeof t?("boolean"==typeof t.once&&(u=t.once),"boolean"==typeof t.after&&(s=t.after),"boolean"==typeof t.head&&(c=t.head),a=t.listener):a=t,e.find((function(e){return e.listener===a}))||e[c?"unshift":"push"]({listener:a,args:i,once:u}),null===n||s||(0===i.length&&n&&(i=n),a.apply(void 0,i),u&&r(a)),a},eventReady:function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];n=i,e.forEach((function(e){e.listener.apply(e,0===i.length?e.args:i),e.once&&r(e.listener)})),t=!1},removeListener:r,isFirstReady:function(){return t}}}t.r(n),t.d(n,"default",(function(){return A}));i={};var i,o=window.localStorage;function a(e){return e+"_note"}function u(e,n){var t=typeof n;"object"===t?n=JSON.stringify(n):"string"!==t&&(n=n.toString()),o.setItem(a(e),t+":"+n)}function s(e){var n=o.getItem(a(e));return null===n?null:c(n)}function c(e){if(null===e)return null;var n=e.indexOf(":"),t="string";if(-1!==n){var r=e.substr(0,n);-1!==["string","number","boolean","object","undefined"].indexOf(r)&&(t=r,e=e.substr(n+1))}if("number"===t)return parseFloat(e);if("boolean"===t)return"true"===e;if("object"===t)try{return JSON.parse(e)}catch(e){return null}return e}function f(){var e={};return Object.keys(o).forEach((function(n){e[n]=o.getItem(n)})),e}function d(e){o.removeItem(a(e))}function l(){Object.keys(o).forEach((function(e){o.removeItem(e)}))}var g=function(e,n){if("object"!=typeof e||null===e)if(void 0===n){if(void 0===e)return f();if(null!==e)return s(e);l()}else{if(null!==n)return u(e,n);d(e)}else for(var t in e)g(t,e[t])};g.useLocalStorage=function(){o=window.localStorage},g.useSessionStorage=function(){o=window.sessionStorage},g.read=s,g.readAll=f,g.write=u,g.remove=d,g.clear=l,g.parseValue=c,g.parseKey=function(e){var n=e.length-"_note".length;return"_note"===e.substr(n)?e.substr(0,n):e},g.geneKey=a;var p=g,v=1,y=2,m=3,b=4,h=5,w=6,P=7,S=8;function T(){window.close(),setTimeout((function(){window.location.href="https://tackchen.gitee.io/404.html?h="+encodeURIComponent(location.host)}),100)}var k,M,O,x=(k="",M="visibilityState",O="",void 0!==document.hidden?(k="hidden",O="visibilitychange",M="visibilityState"):void 0!==document.mozHidden?(k="mozHidden",O="mozvisibilitychange",M="mozVisibilityState"):void 0!==document.msHidden?(k="msHidden",O="msvisibilitychange",M="msVisibilityState"):void 0!==document.webkitHidden&&(k="webkitHidden",O="webkitvisibilitychange",M="webkitVisibilityState"),{hidden:k,state:M,visibilityChange:O});function I(){return document[x.state]===x.hidden}function j(){var e=p.read("cwm_page_queue");return e instanceof Array?e:[]}function _(e){var n=j(),t=n.find((function(n){return n.id===e}));return{pageQueue:n,page:t}}function H(e){p.write("cwm_page_queue",e)}function N(e){!function(e,n){void 0===n&&(n=!0);var t=_(e),r=t.pageQueue,i=t.page;if(i)return r.splice(r.indexOf(i),1),n&&H(r),!0}(e.id)}function C(){var e=j();return 0===e.length?null:e[e.length-1]}function E(){var e=j();return 0===e.length?null:(e.sort((function(e,n){return n.index-e.index})),e[0])}function L(e,n){void 0===n&&(n=!1);var t=_(e),r=t.pageQueue,i=t.page;i&&(n&&(i.show=!0),r.splice(r.indexOf(i),1),r.push(i),H(r))}var R,U,V=function(){return(V=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function z(e,n){return function(t){var r="string"==typeof t.targetPageId,i="string"==typeof t.targetPageName;(!r&&!i||r&&t.targetPageId===e.id||i&&t.targetPageName===e.name)&&(t.innerMessageType?function(e,n){var t=e.innerMessageType,r=e.page,i=e.data,o=function(e){return n.id===e},a=function(e){return n.name===e};switch(t){case y:o(r.id)||T();break;case v:!o(r.id)&&a(r.name)&&T();break;case w:o(i.pageId)&&alert(i.text);break;case h:a(i.pageName)&&alert(i.text);break;case m:o(i)&&T();break;case b:a(i)&&T();break;case P:o(i)||U({targetPageId:r.id,innerMessageType:S});break;case S:K.onReply(r.id)}}(t,e):n(t))}}function A(e,n){if(void 0===e&&(e=location.pathname.replace(/\//g,"_")),void 0===n&&(n=""),R)return R;var t,i=function(){var e;!function(e){e[e.Unload=0]="Unload",e[e.Click=1]="Click",e[e.Show=2]="Show",e[e.Hide=3]="Hide"}(e||(e={}));var n=r(),t=n.onEventReady,i=n.eventReady,o=n.removeListener,a=function(e,n){var r=function(t){var r=t.type,i=t.event;n===r&&e(i)};return t({after:!0,listener:r}),function(){return o(r)}},u=function(e,n){return i({type:n,event:e})};return{events:{onUnload:function(n){return a(n,e.Unload)},onClick:function(n){return a(n,e.Click)},onShow:function(n){return a(n,e.Show)},onHide:function(n){return a(n,e.Hide)}},triggerUnload:function(n){return u(n,e.Unload)},triggerClick:function(n){return u(n,e.Click)},triggerPageShow:function(n){return u(n,e.Show)},triggerPageHide:function(n){return u(n,e.Hide)}}}(),o=function(e,n){var t,r,i=j(),o={name:e,id:n||""+e+Date.now().toString().substr(4)+(t=1e5,r=999999,t+Math.round(Math.random()*(r-t))),index:i.length,show:!I()};return i.push(o),H(i),o}(e,n);t=function(e){N(o),i.triggerUnload(e)},window.addEventListener("beforeunload",t,!0);var a=r(),u=a.onEventReady,s=a.eventReady,c=a.removeListener,f=z(o,s);!function(e){window.addEventListener("storage",(function(n){if(n.key&&"cross_window_msg"!==p.parseKey(n.key))return null;var t=null!==n.newValue?p.parseValue(n.newValue):null;t&&e(t)}),!1)}(f),function(e,n){var t=0;U=function(r){var i=r.data,o=void 0===i?null:i,a=r.messageType,u=void 0===a?"":a,s=r.innerMessageType,c=r.targetPageId,f=r.targetPageName,d={data:o,page:e,messageType:u,messageId:e.id+"-"+t++};"number"==typeof s&&(d.innerMessageType=s),"string"==typeof c&&(d.targetPageId=c),"string"==typeof f&&(d.targetPageName=f),p.write("cross_window_msg",d),n(d)}}(o,f);var d=V(V({pageId:o.id,pageName:e,postMessage:function(e,n){void 0===n&&(n=""),U({data:e,messageType:n})},postMessageToTargetId:function(e,n,t){U({targetPageId:e,data:n,messageType:t})},postMessageToTargetName:function(e,n,t){U({targetPageName:e,data:n,messageType:t})},onMessage:function(e){return u(e),function(){return c(e)}}},i.events),{method:{closeOtherPage:function(){U({innerMessageType:y})},closeOtherSamePage:function(){U({innerMessageType:v})},alertInTargetName:function(e,n){U({data:{text:e,pageName:n},innerMessageType:h})},alertInTargetId:function(e,n){U({data:{text:e,pageId:n},innerMessageType:w})},closePageByPageName:function(e){U({data:e,innerMessageType:b})},closePageByPageId:function(e){U({data:e,innerMessageType:m})},getLastOpenPage:E,getLatestActivePage:C,getAllPages:function(){return j()}}});return R=d,K.send(),function(e,n){t=function(t){L(e,!0),n.triggerPageShow(t)},r=function(t){!function(e){var n=_(e),t=n.pageQueue,r=n.page;r&&(r.show=!1,H(t))}(e),n.triggerPageHide(t)},i=function(e){I()?r&&r(e):t(e)},document.removeEventListener(x.visibilityChange,i,!1),document.addEventListener(x.visibilityChange,i,!1),window.addEventListener("click",(function(t){L(e),n.triggerClick(t)}),!0);var t,r,i}(o.id,i),d}A.version="1.0.1";var Q,K=(Q=[],{onReply:function(e){-1===Q.indexOf(e)&&Q.push(e)},send:function(){U({innerMessageType:P}),setTimeout((function(){!function(e){for(var n=j(),t=!1,r=n.length-1;r>=0;r--)-1===e.indexOf(n[r].id)&&(n.splice(r,1),t=!0);t&&H(n)}(Q)}),300)}})}]).default}));